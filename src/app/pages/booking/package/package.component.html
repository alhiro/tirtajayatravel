<!-- begin::Header -->
<div class="card">
  <div class="card-header border-0 pt-5">
    <h3 class="card-title align-items-start flex-column">
      <span class="card-label fw-bolder fs-3 mb-1">
        @if (currentTab === 'Malang') { Package Table Malang } @else if (currentTab === 'Surabaya') { Package Table
        Surabaya } @else if (currentTab === 'Move') { Package Table Move } @else if (currentTab === 'Cancel') { Package
        Table Cancel } @else if (currentTab === 'History') { Package Table Complete }
      </span>
      <span class="text-muted mt-1 fw-bold fs-7">
        @if (currentTab === 'Malang') { Have {{ dataLengthMalang | number }} items } @else if (currentTab ===
        'Surabaya') { Have {{ dataLengthSurabaya | number }} items } @else if (currentTab === 'Move') { Have
        {{ dataLengthMove | number }} items } @else if (currentTab === 'Cancel') { Have
        {{ dataLengthCancel | number }} items } @else if (currentTab === 'History') { Have
        {{ dataLengthHistory | number }} items }
      </span>
    </h3>
    @if (username === 'admin_11' && levelrule === 8) {
    <div class="card-toolbar">
      <ul class="nav nav-pills nav-pills-sm nav-dark-75">
        <li class="nav-item" (click)="setCurrentTab('Malang')" [style.cursor]="'pointer'">
          <a class="nav-link py-2 px-4" [class.active]="currentTab === 'Malang'" data-toggle="tab">Malang</a>
        </li>
        <li class="nav-item" (click)="setCurrentTab('Surabaya')" [style.cursor]="'pointer'">
          <a class="nav-link py-2 px-4" [class.active]="currentTab === 'Surabaya'" data-toggle="tab">Surabaya</a>
        </li>
      </ul>
    </div>
    }
    <div class="card-toolbar">
      <!-- begin::Menu -->
      <div class="menu-item px-3">
        <div class="menu-content px-3 py-3">
          @if (currentTab === 'Malang') {
          <div class="btn btn-primary btn-sm px-4 cursor-pointer" (click)="openModalNew()">Booking Malang</div>
          } @else if (currentTab === 'Surabaya') {
          <div class="btn btn-primary btn-sm px-4 cursor-pointer" (click)="openModalNew()">Booking Surabaya</div>
          }
        </div>
      </div>
      <!-- end::Menu -->

      @if (!delivery) {
      <div class="col text-end">
        <div ngbDropdown placement="bottom-end" class="d-inline-block">
          <button type="button" class="btn btn-sm btn-light" id="otherspackage" ngbDropdownToggle>More Action</button>
          <div ngbDropdownMenu aria-labelledby="otherspackage">
            <ul class="px-2 mb-0">
              <li class="nav-item dropdown-item" (click)="setCurrentTab('Cancel')" [style.cursor]="'pointer'">
                <a class="nav-link" [class.active]="currentTab === 'Cancel'" data-toggle="tab">Cancel</a>
              </li>
              <li class="nav-item dropdown-item" (click)="setCurrentTab('History')" [style.cursor]="'pointer'">
                <a class="nav-link" [class.active]="currentTab === 'History'" data-toggle="tab">Completed</a>
              </li>
              <li class="nav-item dropdown-item" (click)="datepicker.toggle()">
                <button class="btn btn-primary w-100 p-1">
                  <span translate>Filter Date</span>
                </button>
              </li>
            </ul>
          </div>
        </div>

        <div class="dp-hidden position-absolute">
          <div class="input-group">
            <input
              name="datepicker"
              class="form-control"
              ngbDatepicker
              #datepicker="ngbDatepicker"
              [autoClose]="'outside'"
              (dateSelect)="onDateSelection($event, datepicker)"
              [displayMonths]="2"
              [dayTemplate]="t"
              outsideDays="hidden"
              [startDate]="fromDate!"
              [footerTemplate]="footerTemplate"
              tabindex="-1"
              style="display: none"
            />
            <ng-template #t let-date let-focused="focused">
              <span
                class="custom-day"
                [class.focused]="focused"
                [class.range]="isRange(date)"
                [class.faded]="isHovered(date) || isInside(date)"
                (mouseenter)="hoveredDate = date"
                (mouseleave)="hoveredDate = null"
              >
                {{ date.day }}
              </span>
            </ng-template>
          </div>

          <ng-template #footerTemplate>
            <hr class="my-0" />
            <button class="btn btn-secondary btn-sm m-2 float-end" (click)="resetFilterDate(datepicker)">Reset</button>
          </ng-template>
        </div>
      </div>
      }
    </div>
  </div>
  <!-- end::Header -->
  <!-- begin::Body -->
  <div class="card-body py-3">
    <div class="tab-content mt-5" id="tabPackage">
      <!--begin::Tap pane-->
      <div class="tab-pane fade" role="tabpanel" [ngClass]="{ 'active show': currentTab === 'Malang' }">
        <!-- begin::Table container -->
        <div class="table-responsive">
          <!-- begin::Table -->
          <ngx-table
            #table
            [configuration]="configuration"
            [data]="data"
            [columns]="columns"
            [pagination]="pagination"
            (event)="eventEmitted($event)"
            [detailsTemplate]="detailsTemplate"
            tableClass="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3"
          >
            <ng-template let-row let-index="index">
              <!-- <td>
                    <span class="text-gray-900 d-block">{{ row.category_sub_id }}</span>
                  </td> -->
              <td>
                <span class="text-gray-900 fw-bolder text-hover-primary fs-6" (click)="openModalEdit(row)">
                  {{ row.resi_number }}
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  @if (row.level === 1) {
                  <span class="badge badge-light-primary">Normal</span>
                  } @else {
                  <span class="badge badge-light-danger">Urgent</span>
                  }
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.book_date | date : 'yyyy/MM/dd H:mm:ss a' : 'GMT' }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.sender?.customer?.name }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  {{ row.recipient?.customer?.name }} <br />
                  @if (row.recipient?.customer?.addresses.length > 0) { @for (value of
                  row.recipient?.customer?.addresses; track value) { @if (value.default == true) {
                  {{ value.address }}
                  } } } @else {
                  {{ row.recipient?.customer?.address }}
                  }
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.cost | currency : 'Rp ' : true : '1.0-2' }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.updated_by ? row.updated_by : row.created_by }}</span>
              </td>
              <td>
                <span class="badge badge-light-primary">{{ row.status_package }}</span>
              </td>
              @if (!delivery) {
              <td class="text-end">
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Edit"
                  (click)="openModalEdit(row)"
                >
                  <app-keenicon name="pencil" class="fs-md-3 text-primary"></app-keenicon>
                </a>
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Cancel"
                  (click)="openModalCancel(row)"
                >
                  <app-keenicon name="document" class="fs-md-3 text-info"></app-keenicon>
                </a>
                <a
                  href="javascript:void(0)"
                  class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Delete"
                  (click)="openModalDelete(row)"
                >
                  <app-keenicon name="trash" class="fs-md-3 text-danger"></app-keenicon>
                </a>
              </td>
              } @else {
              <td class="text-end">
                @if (row.status_package === 'Delivery') {
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Remove Driver"
                  (click)="removeDriverSP(row)"
                >
                  <app-keenicon name="minus-square" class="fs-md-3 text-danger"></app-keenicon>
                </a>
                } @else {
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Assign Driver"
                  (click)="assignDriverSP(row)"
                >
                  <app-keenicon name="plus-square" class="fs-md-3 text-primary"></app-keenicon>
                </a>
                }
              </td>
              }
            </ng-template>
          </ngx-table>
          <!-- end::Table -->

          <ng-template #detailsTemplate let-row>
            <!-- <div class="mt-3 mb-5">
                <div class="mb-4">
                  <div class="text-gray-900 fw-bolder text-hover-primary fs-4">{{ row.name }}</div>
                  <div class="text-gray-900">{{ row.telp }}</div>
                </div>
                <div>
                  @if(row.addresses?.length > 0) {
                  <p class="text-gray-900">Status Delivery:</p>
                  <div class="list-full">
                    @for (value of row?.addresses; track value) {
                    <ul class="menu-gray-900 fw-semibold order-1 px-0">
                      <li class="menu-item">
                        <span class="menu-link p-0">{{ value.name }}</span>
                        <span class="menu-link p-0">{{ value.address }}</span>
                        <span class="menu-link p-0">{{ value.telp }}</span>
                        <span class="menu-link p-0">{{ value.description }}</span>
                      </li>
                    </ul>
                    }
                  </div>
                  } @else {
                  <div class="btn btn-primary btn-sm px-4 cursor-pointer" (click)="openModalNewAddress(row)">Add Address</div>
                  }
                </div>
              </div> -->
          </ng-template>
        </div>
        <!-- end::Table container -->
      </div>
      <!--end::Tap pane-->

      <!--begin::Tap pane-->
      <div class="tab-pane fade" role="tabpanel" [ngClass]="{ 'active show': currentTab === 'Surabaya' }">
        <!-- begin::Table container -->
        <div class="table-responsive">
          <!-- begin::Table -->
          <ngx-table
            #table
            [configuration]="configuration"
            [data]="dataSurabaya"
            [columns]="columns"
            [pagination]="pagination"
            (event)="eventEmitted($event)"
            [detailsTemplate]="detailsTemplate"
            tableClass="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3"
          >
            <ng-template let-row let-index="index">
              <!-- <td>
                    <span class="text-gray-900 d-block">{{ row.category_sub_id }}</span>
                  </td> -->
              <td>
                <span class="text-gray-900 fw-bolder text-hover-primary fs-6" (click)="openModalEdit(row)">
                  {{ row.resi_number }}
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  @if (row.level === 1) {
                  <span class="badge badge-light-primary">Normal</span>
                  } @else {
                  <span class="badge badge-light-danger">Urgent</span>
                  }
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.book_date | date : 'yyyy/MM/dd H:mm:ss a' : 'GMT' }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.sender?.customer?.name }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  {{ row.recipient?.customer?.name }}
                </span>
              </td>
              <td>
                <!-- <span class="text-gray-900 d-block">
                  @if ( defaultAddressRecipient) {
                  {{ defaultAddressRecipient.address }}
                  } @else {
                  {{ row.recipient?.customer?.address }}
                  }
                </span> -->
                <span class="text-gray-900 d-block">
                  @if (row.recipient?.customer?.addresses.length > 0) { @for (value of
                  row.recipient?.customer?.addresses; track value) { @if (value.default == true) {
                  {{ value.address }}
                  } } } @else {
                  {{ row.recipient?.customer?.address }}
                  }
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.cost | currency : 'Rp ' : true : '1.0-2' }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.updated_by ? row.updated_by : row.created_by }}</span>
              </td>
              <td>
                <span class="badge badge-light-primary">{{ row.status_package }}</span>
              </td>
              @if (!delivery) {
              <td class="text-end">
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Edit"
                  (click)="openModalEdit(row)"
                >
                  <app-keenicon name="pencil" class="fs-md-3 text-primary"></app-keenicon>
                </a>
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Cancel"
                  (click)="openModalCancel(row)"
                >
                  <app-keenicon name="document" class="fs-md-3 text-info"></app-keenicon>
                </a>
                <a
                  href="javascript:void(0)"
                  class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Delete"
                  (click)="openModalDelete(row)"
                >
                  <app-keenicon name="trash" class="fs-md-3 text-danger"></app-keenicon>
                </a>
              </td>
              } @else {
              <td class="text-end">
                @if (row.status_package === 'Delivery') {
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Remove Driver"
                  (click)="removeDriverSP(row)"
                >
                  <app-keenicon name="minus-square" class="fs-md-3 text-danger"></app-keenicon>
                </a>
                } @else {
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Assign Driver"
                  (click)="assignDriverSP(row)"
                >
                  <app-keenicon name="plus-square" class="fs-md-3 text-primary"></app-keenicon>
                </a>
                }
              </td>
              }
            </ng-template>
          </ngx-table>
          <!-- end::Table -->

          <ng-template #detailsTemplate let-row>
            <!-- <div class="mt-3 mb-5">
                <div class="mb-4">
                  <div class="text-gray-900 fw-bolder text-hover-primary fs-4">{{ row.name }}</div>
                  <div class="text-gray-900">{{ row.telp }}</div>
                </div>
                <div>
                  @if(row.addresses?.length > 0) {
                  <p class="text-gray-900">Status Delivery:</p>
                  <div class="list-full">
                    @for (value of row?.addresses; track value) {
                    <ul class="menu-gray-900 fw-semibold order-1 px-0">
                      <li class="menu-item">
                        <span class="menu-link p-0">{{ value.name }}</span>
                        <span class="menu-link p-0">{{ value.address }}</span>
                        <span class="menu-link p-0">{{ value.telp }}</span>
                        <span class="menu-link p-0">{{ value.description }}</span>
                      </li>
                    </ul>
                    }
                  </div>
                  } @else {
                  <div class="btn btn-primary btn-sm px-4 cursor-pointer" (click)="openModalNewAddress(row)">Add Address</div>
                  }
                </div>
              </div> -->
          </ng-template>
        </div>
        <!-- end::Table container -->
      </div>
      <!--end::Tap pane-->

      <!--begin::Tap pane-->
      <div class="tab-pane fade" role="tabpanel" [ngClass]="{ 'active show': currentTab === 'Cancel' }">
        <!-- begin::Table container -->
        <div class="table-responsive">
          <!-- begin::Table -->
          <ngx-table
            #table
            [configuration]="configuration"
            [data]="dataCancel"
            [columns]="columns"
            [pagination]="pagination"
            (event)="eventEmitted($event)"
            tableClass="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3"
          >
            <ng-template let-row let-index="index">
              <!-- <td>
                    <span class="text-gray-900 d-block">{{ row.category_sub_id }}</span>
                  </td> -->
              <td>
                <span class="text-gray-900 fw-bolder text-hover-primary fs-6" (click)="openModalEdit(row)">
                  {{ row.resi_number }}
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  @if (row.level === 1) {
                  <span class="badge badge-light-primary">Normal</span>
                  } @else {
                  <span class="badge badge-light-danger">Urgent</span>
                  }
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.book_date | date : 'yyyy/MM/dd H:mm:ss a' : 'GMT' }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.sender?.customer?.name }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  {{ row.recipient?.customer?.name }}
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  @if (row.recipient?.customer?.addresses.length > 0) { @for (value of
                  row.recipient?.customer?.addresses; track value) { @if (value.default == true) {
                  {{ value.address }}
                  } } } @else {
                  {{ row.recipient?.customer?.address }}
                  }
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.cost | currency : 'Rp ' : true : '1.0-2' }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.updated_by ? row.updated_by : row.created_by }}</span>
              </td>
              <td>
                <span class="badge badge-light-warning">{{ row.status_package }}</span>
              </td>
              <td class="text-end">
                <a
                  class="btn btn-icon btn-light btn-hover-primary btn-sm cursor-pointer"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Return"
                  (click)="openModalCancel(row)"
                >
                  <app-keenicon name="document" class="fs-md-3 text-primary"></app-keenicon>
                </a>
                <a
                  href="javascript:void(0)"
                  class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Delete"
                  (click)="openModalDelete(row)"
                >
                  <app-keenicon name="trash" class="fs-md-3 text-danger"></app-keenicon>
                </a>
              </td>
            </ng-template>
          </ngx-table>
          <!-- end::Table -->
        </div>
        <!-- end::Table container -->
      </div>
      <!--end::Tap pane-->

      <!--begin::Tap pane-->
      <div class="tab-pane fade" role="tabpanel" [ngClass]="{ 'active show': currentTab === 'History' }">
        <!-- begin::Table container -->
        <div class="table-responsive">
          <!-- begin::Table -->
          <ngx-table
            #table
            [configuration]="configuration"
            [data]="dataHistory"
            [columns]="columns"
            [pagination]="pagination"
            (event)="eventEmitted($event)"
            tableClass="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3"
          >
            <ng-template let-row let-index="index">
              <!-- <td>
                    <span class="text-gray-900 d-block">{{ row.category_sub_id }}</span>
                  </td> -->
              <td>
                <span class="text-gray-900 fw-bolder text-hover-primary fs-6" (click)="openModalEdit(row)">
                  {{ row.resi_number }}
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  @if (row.level === 1) {
                  <span class="badge badge-light-primary">Normal</span>
                  } @else {
                  <span class="badge badge-light-danger">Urgent</span>
                  }
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.book_date | date : 'yyyy/MM/dd H:mm:ss a' : 'GMT' }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.sender?.customer?.name }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  {{ row.recipient?.customer?.name }}
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">
                  @if (row.recipient?.customer?.addresses.length > 0) { @for (value of
                  row.recipient?.customer?.addresses; track value) { @if (value.default == true) {
                  {{ value.address }}
                  } } } @else {
                  {{ row.recipient?.customer?.address }}
                  }
                </span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.cost | currency : 'Rp ' : true : '1.0-2' }}</span>
              </td>
              <td>
                <span class="text-gray-900 d-block">{{ row.updated_by ? row.updated_by : row.created_by }}</span>
              </td>
              <td>
                <span class="badge badge-light-success">{{ row.status_package }}</span>
              </td>
              <td class="text-end">
                <a
                  href="javascript:void(0)"
                  class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm"
                  data-bs-toggle="tooltip"
                  data-bs-trigger="hover"
                  data-bs-dismiss-="click"
                  data-bs-placement="top"
                  title="Detail"
                >
                  <app-keenicon name="eye" class="fs-md-3 text-primary"></app-keenicon>
                </a>
              </td>
            </ng-template>
          </ngx-table>
          <!-- end::Table -->
        </div>
        <!-- end::Table container -->
      </div>
      <!--end::Tap pane-->
    </div>
  </div>
</div>
<!-- begin::Body -->

<!-- begin:: Modal Package -->
<app-modal-xl #modal [modalConfig]="isCreate ? modalConfigCreate : modalConfigEdit">
  <form (ngSubmit)="isCreate ? dataCreate() : dataEdit()" [formGroup]="form" novalidate>
    <div class="d-flex flex-column flex-lg-row">
      <!--begin::Sidebar-->
      <div class="flex-column flex-lg-row-auto w-lg-350px w-xl-450px">
        <!--begin::Card-->
        <div class="card">
          <!--begin::Card body-->
          <div class="card-body">
            <div class="p-0">
              <div class="d-flex flex-center flex-column pb-2">
                <!--begin::Book Date Info-->
                <!-- <date-time-picker-custom
                  class="form-control"
                  formControlName="book_date"
                  [meridian]="false"
                  [hourStep]="1"
                  [minuteStep]="5"
                  [spinners]="false"
                  [placeholder]="placeholderTime"
                >
                </date-time-picker-custom> -->

                <div class="custom-datetime input-group">
                  <input
                    readonly
                    class="form-control"
                    placeholder="Select book date"
                    name="dp"
                    [ngModelOptions]="{ standalone: true }"
                    [(ngModel)]="bookdate"
                    ngbDatepicker
                    [minDate]="minDate"
                    (click)="datePicker.toggle()"
                    #datePicker="ngbDatepicker"
                    (ngModelChange)="onDateChange($event)"
                  />
                  <!-- <ngb-timepicker
                    class="custom-datetime"
                    [hourStep]="1"
                    [minuteStep]="1"
                    [meridian]="false"
                    [ngModelOptions]="{ standalone: true }"
                    [(ngModel)]="booktime"
                    [seconds]="false"
                    [spinners]="false"
                    (ngModelChange)="onTimehange($event)"
                  ></ngb-timepicker> -->

                  <ngb-timepicker-custom
                    [ngModelOptions]="{ standalone: true }"
                    [(ngModel)]="booktime"
                    [hourStep]="1"
                    [minuteStep]="30"
                    [startHour]="1"
                    [endHour]="23"
                    [seconds]="false"
                    [spinners]="false"
                    [select]="true"
                  >
                  </ngb-timepicker-custom>
                </div>
              </div>
              <div class="d-flex flex-center flex-column py-2">
                <input
                  id="select-customer"
                  type="text"
                  class="form-control"
                  [class.is-invalid]="searchFailed"
                  [ngModelOptions]="{ standalone: true }"
                  [(ngModel)]="modelCustomer"
                  [ngbTypeahead]="searchDataCustomer"
                  [resultTemplate]="rt"
                  [inputFormatter]="formatter"
                  placeholder="Customer search"
                />
                <ng-template #rt let-r="result" let-t="term">
                  {{ r.name }}
                </ng-template>

                @if (searching) {
                <small class="form-text text-muted">Searching. Please wait...</small>
                } @if (searchFailed) {
                <div class="invalid-feedback">Sorry, suggestions could not be loaded.</div>
                }
              </div>

              @if (modelCustomer) {
              <div class="d-flex flex-center flex-column py-5 pt-2">
                <!--begin::Info-->
                <!--begin::Info heading-->
                @if (modelCustomer.addresses) {
                <label class="d-block full-width">
                  <select
                    class="form-select form-control"
                    data-kt-select2="true"
                    data-placeholder="Select address"
                    data-allow-clear="true"
                    [ngModelOptions]="{ standalone: true }"
                    [(ngModel)]="modelAddressId"
                    (change)="selectAddress()"
                  >
                    <option value="" disabled selected>Select address</option>
                    @for (value of modelCustomer.addresses; track value) {
                    <option [value]="value.address_id">{{ value.address }}</option>
                    }
                  </select>
                </label>

                <div
                  class="btn btn-primary btn-sm py-1 fs-8 cursor-pointer my-3"
                  (click)="openModalNewAddress(modelCustomer)"
                >
                  Add New Address
                </div>
                }
                <!--end::Info heading-->
                <!--end::Info-->
              </div>
              }

              <!--begin::Summary-->
              <!--begin::Sender Info-->
              @if (modelCustomer) {
              <div class="d-flex flex-center flex-column py-5 pt-0">
                <!--begin::Name-->
                <h4 class="card-title">Choose Sender:</h4>
                <!--begin::Position-->
                <div class="mb-1">
                  <a class="fs-3 text-gray-800 text-hover-primary fw-bold mb-3">{{ modelCustomer?.name }} </a>
                </div>
                @if (modelCustomer.company) {
                <div class="badge badge-lg badge-light-primary d-inline mb-4">
                  {{ modelCustomer.company?.name }}
                </div>
                } @else { }

                <div>Address:</div>
                <div class="mb-9">
                  @if (modelCustomer?.addresses?.length > 0) { @if (selectedAddress) {
                  <div>{{ selectedAddress.address }}</div>
                  } @else {
                  <div>{{ modelCustomer?.address }}</div>
                  } } @else {
                  <div>{{ modelCustomer?.address }}</div>
                  }
                </div>
                <!--end::Position-->
                <!--end::Name-->
              </div>
              }
              <!--end::Sender Info-->
              <!--end::Summary-->

              <hr class="separator py-2" />

              <!--begin::Recipient-->
              <div class="d-flex flex-center flex-column py-2">
                <input
                  id="select-recipient"
                  type="text"
                  class="form-control"
                  [class.is-invalid]="searchFailedRecipient"
                  [ngModelOptions]="{ standalone: true }"
                  [(ngModel)]="modelRecipient"
                  [ngbTypeahead]="searchDataRecipient"
                  [resultTemplate]="rt"
                  [inputFormatter]="formatter"
                  placeholder="Recipient search"
                />
                <ng-template #rt let-r="result" let-t="term">
                  {{ r.name }}
                </ng-template>

                @if (searchingRecipient) {
                <small class="form-text text-muted">Searching. Please wait...</small>
                } @if (searchFailedRecipient) {
                <div class="invalid-feedback">Sorry, suggestions could not be loaded.</div>
                }
              </div>

              @if (modelRecipient) {
              <div class="d-flex flex-center flex-column py-5 pt-2">
                <!--begin::Info-->
                <!--begin::Info heading-->
                @if (modelRecipient.addresses) {
                <label class="d-block full-width">
                  <select
                    class="form-select form-control"
                    data-kt-select2="true"
                    data-placeholder="Select address"
                    data-allow-clear="true"
                    [ngModelOptions]="{ standalone: true }"
                    [(ngModel)]="modelAddressIdRecipient"
                    (change)="selectAddressRecipient()"
                  >
                    <option value="" disabled selected>Select address</option>
                    @for (value of modelRecipient.addresses; track value) {
                    <option [value]="value.address_id">{{ value.address }}</option>
                    }
                  </select>
                </label>
                <div
                  class="btn btn-primary btn-sm py-1 fs-8 cursor-pointer my-3"
                  (click)="openModalNewAddress(modelRecipient)"
                >
                  Add New Address
                </div>
                }
                <!--end::Info heading-->
                <!--end::Info-->
              </div>
              }

              <!--begin::Summary-->
              <!--begin::Sender Info-->
              @if (modelRecipient) {
              <div class="d-flex flex-center flex-column py-5 pt-0">
                <!--begin::Name-->
                <h4 class="card-title">Choose Recipient:</h4>
                <!--begin::Position-->
                <div class="mb-1">
                  <a class="fs-3 text-gray-800 text-hover-primary fw-bold mb-3">{{ modelRecipient?.name }} </a>
                </div>
                @if (modelRecipient.company) {
                <div class="badge badge-lg badge-light-primary d-inline mb-4">
                  {{ modelRecipient.company?.name }}
                </div>
                }

                <div>Address:</div>
                <div class="mb-9">
                  @if (modelRecipient?.addresses?.length > 0) { @if (selectedAddressRecipient) {
                  <div>{{ selectedAddressRecipient.address }}</div>
                  } @else {
                  <div>{{ modelRecipient?.address }}</div>
                  } } @else {
                  <div>{{ modelRecipient?.address }}</div>
                  }
                </div>
                <!--end::Position-->
                <!--end::Name-->
              </div>
              }
              <!--end::Sender Info-->
              <!--end::Summary-->

              <!--begin::Details toggle-->
              <!-- <div class="d-flex flex-stack fs-4 py-3">
                          <div class="fw-bold rotate collapsible" data-bs-toggle="collapse" href="#kt_user_view_details" role="button"
                            aria-expanded="false" aria-controls="kt_user_view_details">
                            Details
                            <span class="ms-2 rotate-180">
                              <i class="ki-duotone ki-down fs-3"></i> </span>
                          </div>
                        
                          <span data-bs-toggle="tooltip" data-bs-trigger="hover" data-bs-original-title="Edit customer details"
                            data-kt-initialized="1">
                            <a href="javascript:void(0)" class="btn btn-sm btn-light-primary" data-bs-toggle="modal" data-bs-target="#kt_modal_update_details">
                              Edit
                            </a>
                          </span>
                        </div> -->
              <!--end::Details toggle-->

              <!-- <div class="separator"></div> -->

              <!--begin::Details content-->
              <!-- <div id="kt_user_view_details" class="collapse show">
                          <div class="pb-5 fs-6">
                            <div class="fw-bold mt-5">Account ID</div>
                            <div class="text-gray-600">ID-45453423</div>
                            <div class="fw-bold mt-5">Address</div>
                            <div class="text-gray-600">101 Collin Street, <br>Melbourne 3000 VIC<br>Australia</div>
                          </div>
                        </div> -->
              <!--end::Details content-->
            </div>
          </div>
          <!--end::Card body-->
        </div>
        <!--end::Card-->
      </div>
      <!--end::Sidebar-->

      <!--begin::Content-->
      <div class="flex-lg-row-fluid ms-lg-15">
        <!--begin::Card-->
        <div class="card card-flush mb-6 mb-xl-9">
          <!--begin::Card body-->
          <div class="card-body p-9 pt-4">
            <div class="m-3">
              <!-- <label class="d-block mb-4">
                <select
                  class="form-select form-control"
                  data-kt-select2="true"
                  data-placeholder="Select city"
                  data-allow-clear="true"
                  formControlName="city_id"
                >
                  <option value="" disabled selected>Select city</option>
                  @for (value of city; track value) {
                  <option [value]="value.city_id">{{ value.name }}</option>
                  }
                </select>
              </label> -->
              <label class="d-block mb-4">
                <input
                  type="text"
                  class="form-control"
                  formControlName="cost"
                  autocomplete="cost"
                  [placeholder]="'Cost' | translate"
                />
                <span hidden translate>Cost</span>
              </label>
              <label class="d-block mb-4">
                <input
                  type="text"
                  class="form-control"
                  formControlName="discount"
                  autocomplete="discount"
                  [placeholder]="'Discount' | translate"
                />
                <span hidden translate>Discount</span>
              </label>
              <label class="d-block mb-4">
                <input
                  type="text"
                  class="form-control"
                  formControlName="koli"
                  autocomplete="koli"
                  [placeholder]="'Koli' | translate"
                />
                <span hidden translate>Amount Koli</span>
              </label>
              <label class="d-block mb-4">
                <select
                  class="form-select form-control"
                  data-kt-select2="true"
                  data-placeholder="Select category"
                  data-allow-clear="true"
                  formControlName="category_id"
                >
                  <option value="" disabled selected>Select category</option>
                  @for (value of category; track value) {
                  <option [value]="value.category_id">{{ value.name }}</option>
                  }
                </select>
              </label>

              <div class="mb-2">
                <div class="d-flex">
                  <label class="form-label fw-bold" [attr.for]="request">Special Request </label>
                  <label class="form-check form-check-sm form-check-solid me-5 mx-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [attr.id]="request"
                      [checked]="isRequest"
                      (change)="checkRequest()"
                    />
                  </label>
                </div>
              </div>

              @if (isRequest) {
              <label class="d-block mb-4">
                <select
                  class="form-select form-control"
                  data-kt-select2="true"
                  data-placeholder="Select request"
                  data-allow-clear="true"
                  formControlName="request"
                >
                  <option value="" disabled selected>Select request</option>
                  @for (value of request; track value) {
                  <option [value]="value.name">{{ value.name }}</option>
                  }
                </select>
              </label>
              <label class="d-block mb-4">
                <input
                  type="text"
                  class="form-control"
                  formControlName="request_description"
                  autocomplete="request_description"
                  [placeholder]="'Request Description' | translate"
                />
                <span hidden translate>Request Description</span>
              </label>
              }

              <label class="d-block mb-4">
                <input
                  type="text"
                  class="form-control"
                  formControlName="description"
                  autocomplete="description"
                  [placeholder]="'Description' | translate"
                />
                <span hidden translate>Description</span>
              </label>
              <!-- <label class="d-block mb-4">
                <select
                  class="form-select form-control"
                  data-kt-select2="true"
                  data-placeholder="Select payment status"
                  data-allow-clear="true"
                  formControlName="status"
                >
                  <option value="" disabled selected>Select payment status</option>
                  @for (value of status; track value) {
                  <option [value]="value.name">{{ value.name }}</option>
                  }
                </select>
              </label> -->
              <div class="mb-4">
                <label class="form-label fw-bold">Payment status:</label>
                <div class="d-flex">
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input
                      class="form-check-input"
                      type="radio"
                      value="Lunas (Kantor)"
                      name="status"
                      formControlName="status"
                    />
                    <span class="form-check-label text-gray-900">Lunas (Kantor)</span>
                  </label>
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input
                      class="form-check-input"
                      type="radio"
                      value="Lunas (Transfer)"
                      name="status"
                      formControlName="status"
                    />
                    <span class="form-check-label text-gray-900">Lunas (Transfer)</span>
                  </label>
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input
                      class="form-check-input"
                      type="radio"
                      value="Bayar Tujuan (COD)"
                      name="status"
                      formControlName="status"
                    />
                    <span class="form-check-label text-gray-900">Bayar Tujuan (COD)</span>
                  </label>
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input
                      class="form-check-input"
                      type="radio"
                      value="Piutang"
                      name="status"
                      formControlName="status"
                    />
                    <span class="form-check-label text-gray-900">Piutang</span>
                  </label>
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input
                      class="form-check-input"
                      type="radio"
                      value="Customer (Bulanan)"
                      name="status"
                      formControlName="status"
                    />
                    <span class="form-check-label text-gray-900">Customer (Bulanan)</span>
                  </label>
                </div>
              </div>
              <div class="mb-4">
                <label class="form-label fw-bold">Origin From:</label>
                <div class="d-flex">
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input
                      class="form-check-input"
                      type="radio"
                      value="Kantor"
                      name="origin_from"
                      formControlName="origin_from"
                    />
                    <span class="form-check-label text-gray-900">Kantor</span>
                  </label>
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input
                      class="form-check-input"
                      type="radio"
                      value="Ambil"
                      name="origin_from"
                      formControlName="origin_from"
                    />
                    <span class="form-check-label text-gray-900">Ambil</span>
                  </label>
                </div>
              </div>
              <div class="mb-4">
                <label class="form-label fw-bold">Level:</label>
                <div class="d-flex">
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input class="form-check-input" type="radio" [value]="1" name="level" formControlName="level" />
                    <span class="form-check-label text-gray-900">Normal</span>
                  </label>
                  <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                    <input class="form-check-input" type="radio" [value]="2" name="level" formControlName="level" />
                    <span class="form-check-label text-gray-900">Urgent</span>
                  </label>
                </div>
              </div>
              <!-- @if (!isCreate) {
              <label class="d-block mb-8">
                <select
                  class="form-select form-control"
                  data-kt-select2="true"
                  data-placeholder="Select status package"
                  data-allow-clear="true"
                  formControlName="status_package"
                >
                  <option value="" disabled selected>Select status package</option>
                  @for (value of statusPackage; track value) {
                  <option [value]="value.name">{{ value.name }}</option>
                  }
                </select>
              </label>
              } -->
            </div>
          </div>
          <!--end::Card body-->
        </div>
        <!--end::Card-->
      </div>
      <!--end::Content-->
    </div>

    <div>
      <button class="btn btn-primary w-100" type="submit" [disabled]="form.invalid || isLoading">
        <!--begin::Spinner-->
        <span
          class="translate-middle-y lh-0 me-1"
          data-kt-search-element="spinner"
          [ngClass]="isLoading ? '' : 'd-none'"
        >
          <span class="spinner-border h-15px w-15px align-middle text-gray-500"></span>
        </span>
        <!--end::Spinner-->
        <span translate>Submit</span>
      </button>
    </div>
  </form>
</app-modal-xl>
<!-- Note: Don't forget import ModalsModule (from _metronic/partials) into your module -->
<!-- end:: Modal customer -->

<!-- begin:: Modal Address -->
<app-modal #modalAddress [modalConfig]="isCreateAddress ? modalConfigCreateAddress : modalConfigEditAddress">
  <form (ngSubmit)="isCreateAddress ? dataCreateAddress() : dataEditAddress()" [formGroup]="formAddress" novalidate>
    <div class="m-3">
      <label class="d-block mb-4">
        <input
          type="text"
          class="form-control"
          formControlName="name"
          autocomplete="name"
          [placeholder]="'Name' | translate"
        />
        <span hidden translate>Name</span>
        <small *ngIf="fa['name'].errors?.['maxlength']" class="text-danger" translate>
          Name maximum 100 characters</small
        >
      </label>
      <label class="d-block mb-4">
        <input
          type="text"
          class="form-control"
          formControlName="address"
          autocomplete="address"
          [placeholder]="'Address' | translate"
        />
        <span hidden translate>Address</span>
        <small *ngIf="fa['address'].errors?.['maxlength']" class="text-danger" translate>
          Address maximum 255 characters</small
        >
      </label>
      <label class="d-block mb-4">
        <input
          type="text"
          class="form-control"
          formControlName="telp"
          autocomplete="telp"
          [placeholder]="'Telp' | translate"
        />
        <span hidden translate>Telp</span>
        <small *ngIf="fa['telp'].errors?.['maxlength']" class="text-danger" translate>
          Telp maximum 255 characters</small
        >
      </label>
      <label class="d-block mb-4">
        <input
          type="text"
          class="form-control"
          formControlName="longitude"
          autocomplete="longitude"
          [placeholder]="'Longitude' | translate"
        />
        <span hidden translate>Longitude</span>
        <small *ngIf="fa['longitude'].errors?.['maxlength']" class="text-danger" translate>
          Longitude maximum 100 characters</small
        >
      </label>
      <label class="d-block mb-4">
        <input
          type="text"
          class="form-control"
          formControlName="latitude"
          autocomplete="latitude"
          [placeholder]="'Latitude' | translate"
        />
        <span hidden translate>Latitude</span>
        <small *ngIf="fa['latitude'].errors?.['maxlength']" class="text-danger" translate>
          Latitude maximum 100 characters</small
        >
      </label>
      <label class="d-block mb-4">
        <input
          type="text"
          class="form-control"
          formControlName="zoom"
          autocomplete="zoom"
          [placeholder]="'Zoom' | translate"
        />
        <span hidden translate>Zoom</span>
        <small *ngIf="fa['zoom'].errors?.['maxlength']" class="text-danger" translate> Zoom maximum 5 characters</small>
      </label>
      <label class="d-block mb-4">
        <input
          type="text"
          class="form-control"
          formControlName="description"
          autocomplete="description"
          [placeholder]="'Description' | translate"
        />
        <span hidden translate>Description</span>
        <small *ngIf="fa['description'].errors?.['maxlength']" class="text-danger" translate>
          Description maximum 255 characters</small
        >
      </label>
    </div>
    <div class="mt-10">
      <button class="btn btn-primary w-100" type="submit" [disabled]="form.invalid || isLoading">
        <!--begin::Spinner-->
        <span
          class="translate-middle-y lh-0 me-1"
          data-kt-search-element="spinner"
          [ngClass]="isLoading ? '' : 'd-none'"
        >
          <span class="spinner-border h-15px w-15px align-middle text-gray-500"></span>
        </span>
        <!--end::Spinner-->
        <span translate>Submit</span>
      </button>
    </div>
  </form>
</app-modal>
<!-- Note: Don't forget import ModalsModule (from _metronic/partials) into your module -->
<!-- end:: Modal address -->

<!-- begin:: Modal SP -->
<app-modal #modalSP [modalConfig]="modalConfigCreateSP">
  <form (ngSubmit)="dataCreateSP()" [formGroup]="formSP" novalidate>
    <div class="m-3">
      <label class="d-block mb-4">
        <input
          id="select-employee"
          type="text"
          class="form-control"
          [class.is-invalid]="searchFailed"
          [ngModelOptions]="{ standalone: true }"
          [(ngModel)]="modelEmployee"
          [ngbTypeahead]="searchDataEmployee"
          [resultTemplate]="rt"
          [inputFormatter]="formatter"
          placeholder="Employee search"
        />
        <ng-template #rt let-r="result" let-t="term">
          {{ r.name }}
        </ng-template>

        @if (searchingEmployee) {
        <small class="form-text text-muted">Searching. Please wait...</small>
        } @if (searchFailedEmployee) {
        <div class="invalid-feedback">Sorry, suggestions could not be loaded.</div>
        } @if (modelEmployee) {
        <!--begin::Details toggle-->
        <div class="d-flex flex-stack fs-4 py-3">
          <div
            class="fw-bold rotate collapsible"
            role="button"
            aria-expanded="false"
            aria-controls="kt_user_view_details"
          >
            Details
          </div>
        </div>
        <!--end::Details toggle-->

        <div class="separator"></div>

        <!--begin::Details content-->
        <div id="kt_user_view_details" class="collapse show">
          <div class="pb-5 fs-6">
            <div class="fw-bold">Name</div>
            <div class="text-gray-600">{{ modelEmployee?.name }}</div>
            <div class="fw-bold mt-3">Telp</div>
            <div class="text-gray-600">{{ modelEmployee?.telp }}</div>
            <div class="fw-bold mt-3">Photo</div>
            <!-- <div class="text-gray-600">
                  <img class="full-width" src="../../../../assets/media/avatars/300-1.jpg"/>
                </div> -->
          </div>
        </div>
        }
        <!--end::Details content-->
      </label>
      <label class="d-block mb-4">
        <input
          id="select-car"
          type="text"
          class="form-control"
          [class.is-invalid]="searchFailed"
          [ngModelOptions]="{ standalone: true }"
          [(ngModel)]="modelCar"
          [ngbTypeahead]="searchDataCar"
          [resultTemplate]="rt"
          [inputFormatter]="formatter"
          placeholder="Car search"
        />
        <ng-template #rt let-r="result" let-t="term">
          {{ r.name }}
        </ng-template>

        @if (searchingCar) {
        <small class="form-text text-muted">Searching. Please wait...</small>
        } @if (searchFailedCar) {
        <div class="invalid-feedback">Sorry, suggestions could not be loaded.</div>
        } @if (modelCar) {
        <!--begin::Details toggle-->
        <div class="d-flex flex-stack fs-4 py-3">
          <div
            class="fw-bold rotate collapsible"
            role="button"
            aria-expanded="false"
            aria-controls="kt_user_view_details"
          >
            Details
          </div>
        </div>
        <!--end::Details toggle-->

        <div class="separator"></div>

        <!--begin::Details content-->
        <div id="kt_user_view_details" class="collapse show">
          <div class="pb-5 fs-6">
            <div class="fw-bold">Name</div>
            <div class="text-gray-600">{{ this.modelCar?.name }}</div>
            <div class="fw-bold mt-3">Plat Number</div>
            <div class="text-gray-600">{{ this.modelCar?.number_plat }}</div>
            <div class="fw-bold mt-3">Car Number</div>
            <div class="text-gray-600">{{ this.modelCar?.car_number }}</div>
            <div class="fw-bold mt-3">Photo</div>
            <!-- <div class="text-gray-600">
                  <img class="full-width" src="../../../../assets/media/stock/600x400/img-10.jpg"/>
                </div> -->
          </div>
        </div>
        }
        <!--end::Details content-->
      </label>
      <label class="d-block mb-4">
        <input
          type="text"
          class="form-control"
          formControlName="description"
          autocomplete="description"
          [placeholder]="'Description' | translate"
        />
        <span hidden translate>Description Name</span>
      </label>
      <div class="mb-4">
        <label class="form-label fw-bold">Status:</label>
        <div class="d-flex">
          <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
            <input class="form-check-input" type="radio" value="Reguler" name="status" formControlName="status" />
            <span class="form-check-label text-gray-900">Reguler</span>
          </label>
          <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
            <input class="form-check-input" type="radio" value="Box" name="status" formControlName="status" />
            <span class="form-check-label text-gray-900">Box</span>
          </label>
        </div>
      </div>
    </div>
    <div class="mt-10">
      <button class="btn btn-primary w-100" type="submit" [disabled]="form.invalid || isLoading">
        <!--begin::Spinner-->
        <span
          class="translate-middle-y lh-0 me-1"
          data-kt-search-element="spinner"
          [ngClass]="isLoading ? '' : 'd-none'"
        >
          <span class="spinner-border h-15px w-15px align-middle text-gray-500"></span>
        </span>
        <!--end::Spinner-->
        <span translate>Submit</span>
      </button>
    </div>
  </form>
</app-modal>
<!-- Note: Don't forget import ModalsModule (from _metronic/partials) into your module -->
<!-- end:: Modal sp -->
